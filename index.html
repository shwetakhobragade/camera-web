<script>
  // Start camera
  navigator.mediaDevices.getUserMedia({ video: true })
    .then((stream) => {
      const video = document.getElementById("video");
      video.srcObject = stream;
    })
    .catch((err) => {
      alert("Camera not supported or permission denied.");
      console.error(err);
    });

  // Face detection and image capture
  document.addEventListener("DOMContentLoaded", () => {
    const captureBtn = document.getElementById("capture");

    captureBtn.addEventListener("click", async () => {
      const video = document.getElementById("video");
      const canvas = document.createElement("canvas");
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
      const ctx = canvas.getContext("2d");
      ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

      if ('FaceDetector' in window) {
        const faceDetector = new FaceDetector({ fastMode: true, maxDetectedFaces: 1 });
        try {
          const faces = await faceDetector.detect(canvas);
          if (faces.length > 0) {
            const dataURL = canvas.toDataURL("image/jpeg");
            localStorage.setItem("capturedImage", dataURL);
            document.getElementById("preview").src = dataURL;
            alert("✅ Face detected! Image captured.");
          } else {
            alert("❌ No face detected. Please try again.");
          }
        } catch (err) {
          alert("Face detection failed.");
          console.error(err);
        }
      } else {
        alert("Face detection is not supported in this browser.");
      }
    });
  });
</script>
